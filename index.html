<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Z-Apocalypse Simulator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              'zombie-green': '#84cc16',
              'blood-red': '#ef4444',
              'dark-slate': '#0f172a',
            },
            fontFamily: {
              mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
            }
          },
        },
      }
    </script>
    <!-- React & Babel Standalone (for running JSX/TS directly in browser) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      /* Custom Animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }
      .cursor-wait {
        cursor: wait;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.2.7",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-gray-50 text-slate-900 dark:bg-dark-slate dark:text-slate-200 transition-colors duration-300">
    <div id="root"></div>

    <!-- Main Application Script -->
    <script type="text/babel" data-presets="typescript,react">
      const { useState, useEffect, useCallback, useRef, useMemo } = React;

      // --- CONSTANTS ---
      const MBTI_TYPES = [
        'ISTJ', 'ISFJ', 'INFJ', 'INTJ',
        'ISTP', 'ISFP', 'INFP', 'INTP',
        'ESTP', 'ESFP', 'ENFP', 'ENTP',
        'ESTJ', 'ESFJ', 'ENFJ', 'ENTJ'
      ];

      const MAX_HP = 100;
      const MAX_SANITY = 100;
      const INITIAL_INVENTORY = ['Bottle of Water', 'Pocket Knife'];
      const DEFAULT_RELATIONSHIP_VALUE = 0;

      // --- SIMULATION SERVICE LOGIC ---
      const ANALYSTS = ['INTJ', 'INTP', 'ENTJ', 'ENTP'];
      const DIPLOMATS = ['INFJ', 'INFP', 'ENFJ', 'ENFP'];
      const SENTINELS = ['ISTJ', 'ISFJ', 'ESTJ', 'ESFJ'];
      const EXPLORERS = ['ISTP', 'ISFP', 'ESTP', 'ESFP'];

      const GLOBAL_EVENTS = [
          "ì˜¤ëŠ˜ì€ ì•ˆê°œê°€ ì§™ê²Œ ë¼ì—ˆìŠµë‹ˆë‹¤. ì¢€ë¹„ë“¤ì˜ ì‹ ìŒì†Œë¦¬ê°€ ê°€ê¹Œì´ì—ì„œ ë“¤ë¦½ë‹ˆë‹¤.",
          "í­ìš°ê°€ ìŸì•„ì ¸ ì‹œì•¼ê°€ í™•ë³´ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ëª¨ë‘ê°€ ìº í”„ ì•ˆì— ë¨¸ë¬¼ëŸ¬ì•¼ í•©ë‹ˆë‹¤.",
          "ë§‘ì€ ë‚ ì”¨ì§€ë§Œ, ì‹ëŸ‰ì´ ë°”ë‹¥ë‚˜ê³  ìžˆìŠµë‹ˆë‹¤. ëˆ„êµ°ê°€ëŠ” ë°–ìœ¼ë¡œ ë‚˜ê°€ì•¼ í•©ë‹ˆë‹¤.",
          "ë²„ë ¤ì§„ ì‡¼í•‘ëª°ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ìœ„í—˜í•´ ë³´ì´ì§€ë§Œ ë¬¼ìžëŠ” í’ë¶€í•´ ë³´ìž…ë‹ˆë‹¤.",
          "ë°¤ìƒˆ ì¢€ë¹„ ë–¼ê°€ ìº í”„ ì£¼ë³€ì„ ë°°íšŒí–ˆìŠµë‹ˆë‹¤. ëª¨ë‘ê°€ ìž ì„ ì„¤ì³¤ìŠµë‹ˆë‹¤.",
          "ë¼ë””ì˜¤ì—ì„œ ëŠì–´ì§€ëŠ” êµ¬ì¡° ì‹ í˜¸ê°€ ìž¡í˜”ìŠµë‹ˆë‹¤. í¬ë§ì¼ê¹Œìš”, í•¨ì •ì¼ê¹Œìš”?",
          "ì¡°ìš©í•œ í•˜ë£¨ìž…ë‹ˆë‹¤. í­í’ì „ì•¼ ê°™ì€ ê³ ìš”í•¨ì´ íë¦…ë‹ˆë‹¤.",
          "ë©€ë¦¬ì„œ ì´ì†Œë¦¬ê°€ ë“¤ë ¸ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ìƒì¡´ìžë“¤ì¼ê¹Œìš”? ì•„ë‹ˆë©´ ì•½íƒˆìžë“¤ì¼ê¹Œìš”?",
          "ì‹ìˆ˜ì›ì´ ì˜¤ì—¼ëœ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì •ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
          "ì—„ì²­ë‚œ ë”ìœ„ê°€ ì°¾ì•„ì™”ìŠµë‹ˆë‹¤. íƒˆìˆ˜ ì¦ì„¸ê°€ ê±±ì •ë©ë‹ˆë‹¤.",
          "ëˆˆì´ ë‚´ë¦¬ê¸° ì‹œìž‘í•©ë‹ˆë‹¤. ì¶”ìœ„ì™€ì˜ ì‹¸ì›€ì´ ì‹œìž‘ë˜ì—ˆìŠµë‹ˆë‹¤.",
          "ê¹Œë§ˆê·€ë“¤ì´ ë–¼ì§€ì–´ ë‚ ì•„ê°‘ë‹ˆë‹¤. ë¶ˆê¸¸í•œ ì§•ì¡°ìž…ë‹ˆë‹¤.",
          "ì˜¤ëž˜ëœ êµ°ì‚¬ íŠ¸ëŸ­ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì“¸ë§Œí•œ ìž¥ë¹„ê°€ ìžˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.",
          "ì•¼ìƒ ë™ë¬¼ì˜ í”ì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ì‚¬ëƒ¥ê°ì¼ê¹Œìš”, í¬ì‹ìžì¼ê¹Œìš”?",
          "ì•½êµ­ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. í•­ìƒì œì™€ ë¶•ëŒ€ë¥¼ ì±™ê¸¸ ê¸°íšŒìž…ë‹ˆë‹¤.",
          "ìº í”„ ê·¼ì²˜ì—ì„œ ìˆ˜ìƒí•œ ë°œìžêµ­ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ëˆ„êµ°ê°€ ìš°ë¦´ ê°ì‹œí•˜ê³  ìžˆìŠµë‹ˆë‹¤.",
          "ë³´ë¦„ë‹¬ì´ ë–´ìŠµë‹ˆë‹¤. ì™ ì§€ ì¢€ë¹„ë“¤ì´ í‰ì†Œë³´ë‹¤ ë” ì‚¬ë‚˜ì›Œ ë³´ìž…ë‹ˆë‹¤.",
          "ê°•í•œ ë°”ëžŒì´ ë¶ˆì–´ ë°”ë¦¬ì¼€ì´ë“œ ì¼ë¶€ê°€ ë¬´ë„ˆì¡ŒìŠµë‹ˆë‹¤. ê¸´ê¸‰ ë³´ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
          "ì˜¤ëž˜ëœ ë„ì„œê´€ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤. ìƒì¡´ ì§€ì¹¨ì„œë¥¼ êµ¬í•  ìˆ˜ ìžˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.",
          "ëˆ„êµ°ê°€ ì‹¤ìˆ˜ë¡œ í° ì†Œë¦¬ë¥¼ ëƒˆìŠµë‹ˆë‹¤. ê³§ ì¢€ë¹„ë“¤ì´ ëª°ë ¤ì˜¬ ê²ƒìž…ë‹ˆë‹¤.",
          "í•˜ëŠ˜ì— í—¬ë¦¬ì½¥í„°ê°€ ì§€ë‚˜ê°€ëŠ” ê²ƒì´ ë³´ì˜€ìŠµë‹ˆë‹¤. êµ¬ì¡° ìš”ì²­ì„ ë³´ë‚´ê¸°ì—” ë„ˆë¬´ ë©€ì—ˆìŠµë‹ˆë‹¤.",
          "ì©ì€ ëƒ„ìƒˆê°€ ì§„ë™ì„ í•©ë‹ˆë‹¤. ê·¼ì²˜ì— ëŒ€ê·œëª¨ ì‹œì²´ ë¬´ë”ê¸°ê°€ ìžˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.",
          "ë²„ë ¤ì§„ ë†€ì´ê³µì›ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. ê¸°ê´´í•œ ìŒì•… ì†Œë¦¬ê°€ ëŠê²¨ì„œ ë“¤ë¦½ë‹ˆë‹¤.",
          "ì‹ëŸ‰ ì°½ê³ ì—ì„œ ì¥ ë–¼ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹ëŸ‰ ì¼ë¶€ë¥¼ ë²„ë ¤ì•¼ í•©ë‹ˆë‹¤.",
          "ê°‘ìž‘ìŠ¤ëŸ¬ìš´ ì§€ì§„ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê±´ë¬¼ì´ í”ë“¤ë¦¬ê³  ëª¨ë‘ê°€ ë„˜ì–´ì¡ŒìŠµë‹ˆë‹¤.",
          "ìˆ²ì—ì„œ ì •ì²´ë¶ˆëª…ì˜ ì—´ë§¤ë¥¼ ê°€ë“ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ë¨¹ì„ ìˆ˜ ìžˆì„ì§€ ê³ ë¯¼ìž…ë‹ˆë‹¤.",
          "ì£½ì€ ì¤„ ì•Œì•˜ë˜ ì¢€ë¹„ í•˜ë‚˜ê°€ ê°‘ìžê¸° ìº í”„ ì•ˆì—ì„œ ì¼ì–´ë‚˜ ì†Œë™ì´ ë²Œì–´ì¡ŒìŠµë‹ˆë‹¤.",
          "ë¼ë””ì˜¤ì—ì„œ 70-80ë…„ëŒ€ ìŒì•…ì´ í˜ëŸ¬ë‚˜ì˜µë‹ˆë‹¤. ëˆ„êµ°ê°€ì˜ ìž¥ë‚œì¼ê¹Œìš”?",
          "ë¹„ê°€ ê·¸ì¹˜ê³  ë¬´ì§€ê°œê°€ ë–´ìŠµë‹ˆë‹¤. ìž ì‹œë‚˜ë§ˆ í‰í™”ë¡œìš´ ê¸°ë¶„ì„ ëŠë‚ë‹ˆë‹¤.",
          "ë‚¡ì€ ìº í•‘ì¹´ë¥¼ ë°œê²¬í–ˆì§€ë§Œ ê¸°ë¦„ì´ ì—†ì–´ ì›€ì§ì¼ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.",
          "ì •ì²´ë¶ˆëª…ì˜ ê·¸ë¦¼ìžê°€ ìº í”„ ì£¼ë³€ì„ ë§´ëŒë‹¤ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.",
          "ëˆ„êµ°ê°€ ë‚¨ê¸´ 'ìƒì¡´ìž ìžˆìŒ' í‘œì§€íŒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. í¬ë§ì„ ê°€ì ¸ë´…ë‹ˆë‹¤.",
          "ê°‘ìž‘ìŠ¤ëŸ¬ìš´ ì†Œë‚˜ê¸°ë¡œ ì‹ìˆ˜ë¥¼ ë³´ì¶©í•  ìˆ˜ ìžˆì—ˆìŠµë‹ˆë‹¤.",
          "ìˆ²ì—ì„œ ì¢€ë¹„ê°€ ë«ì— ê±¸ë ¤ ìžˆëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. ëˆ„êµ°ê°€ ê·¼ì²˜ì— ìžˆìŠµë‹ˆë‹¤.",
          "ëª¨ë‹¥ë¶ˆ ì£¼ë³€ì— ëª¨ì—¬ ë¬´ì„œìš´ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©° ê¸´ìž¥ì„ í’€ì—ˆìŠµë‹ˆë‹¤.",
          "ë‚¡ì€ ê¸°íƒ€ í•˜ë‚˜ë¡œ ìž‘ì€ ìŒì•…íšŒê°€ ì—´ë ¸ìŠµë‹ˆë‹¤.",
          "ì¢€ë¹„ ë–¼ê°€ ì„œë¡œ ì—‰ì¼œ ê±°ëŒ€í•œ ë©ì–´ë¦¬ê°€ ëœ ê²ƒì„ ë³´ê³  ë„ë§ì³¤ìŠµë‹ˆë‹¤.",
          "ì˜¤ëž˜ëœ ë§Œí™”ì±…ì„ ë°œê²¬í•´ ëŒë ¤ë³´ë©° ìž ì‹œ ì›ƒì—ˆìŠµë‹ˆë‹¤.",
          "ì•ˆê°œê°€ ë„ˆë¬´ ì§™ì–´ ë°”ë¡œ ì•žë„ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì„œë¡œì˜ ì†ì„ ìž¡ê³  ì´ë™í•´ì•¼ í•©ë‹ˆë‹¤.",
          "ë²„ë ¤ì§„ ê²½ì°°ì„œë¥¼ ë°œê²¬í–ˆì§€ë§Œ, ì´ë¯¸ ëˆ„êµ°ê°€ ë‹¤ë…€ê°„ í”ì ì´ ìžˆìŠµë‹ˆë‹¤.",
          "í•˜ìˆ˜êµ¬ì—ì„œ ì´ìƒí•œ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜µë‹ˆë‹¤. ì ‘ê·¼í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ê² ìŠµë‹ˆë‹¤.",
          "ì•¼ìƒ ë“¤ê°œ ë¬´ë¦¬ê°€ ë‚˜íƒ€ë‚˜ ì‹ëŸ‰ì„ ë…¸ë¦¬ê³  ìžˆìŠµë‹ˆë‹¤.",
          "ë°¤í•˜ëŠ˜ì— ìœ ì„±ì´ ë–¨ì–´ì¡ŒìŠµë‹ˆë‹¤. ì†Œì›ì„ ë¹ˆ ì‚¬ëžŒì€ ì•„ë¬´ë„ ì—†ì—ˆìŠµë‹ˆë‹¤."
      ];

      const getPronoun = (gender) => {
          if (gender === 'Male') return 'ê·¸';
          if (gender === 'Female') return 'ê·¸ë…€';
          return 'ê·¸ë“¤';
      };

      const INTERACTION_TEMPLATES = {
          POSITIVE: [
              (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ì„œë¡œì˜ ë“±ì„ ì§€ì¼œì£¼ë©° ì‹ ë¢°ë¥¼ ìŒ“ì•˜ìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì—ê²Œ ìžì‹ ì˜ ë¹„ìƒ ì‹ëŸ‰ì„ ë‚˜ëˆ ì£¼ì—ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ì˜›ë‚  ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©° ê¹Šì€ ìœ ëŒ€ê°ì„ ëŠê¼ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ìœ„í—˜ì— ì²˜í•œ ${b}ì„(ë¥¼) ê°„ë°œì˜ ì°¨ë¡œ êµ¬í–ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) í•¨ê»˜ ë³´ì´ˆë¥¼ ì„œë©° ì„œë¡œì— ëŒ€í•´ ë” ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ ìƒì²˜ë¥¼ ì •ì„±ê» ì¹˜ë£Œí•´ì£¼ì—ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ë¯¸ëž˜ì— ëŒ€í•œ í¬ë§ì„ ì´ì•¼ê¸°í•˜ë©° ì„œë¡œë¥¼ ê²©ë ¤í–ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì´(ê°€) íž˜ë“¤ì–´í•˜ëŠ” ê²ƒì„ ë³´ê³  ì¡°ìš©ížˆ ë„ì™€ì£¼ì—ˆìŠµë‹ˆë‹¤.`
          ],
          NEGATIVE: [
              (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ ë°©ì‹ì´ ë§ˆìŒì— ë“¤ì§€ ì•Šì•„ ì–¸ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ ë¬´ëª¨í•œ í–‰ë™ì„ ë¹„ë‚œí•˜ë©° í™”ë¥¼ ëƒˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ì´ë™ ê²½ë¡œë¥¼ ë‘ê³  ì‹¬í•˜ê²Œ ë‹¤íˆ¬ì—ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì´(ê°€) ì‹ëŸ‰ì„ í›”ì³¤ë‹¤ê³  ì˜ì‹¬í–ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ íƒœë„ê°€ ë§ˆìŒì— ë“¤ì§€ ì•Šì•„ ì°¨ê°‘ê²Œ ëŒ€í–ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì™€(ê³¼) ${b} ì‚¬ì´ì—ëŠ” ìˆ¨ë§‰ížˆëŠ” ì¹¨ë¬µë§Œì´ í˜ë €ìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ ì‹¤ìˆ˜ ë•Œë¬¸ì— ìœ„í—˜ì— ì²˜í•  ë»”í–ˆë‹¤ë©° íƒ“í–ˆìŠµë‹ˆë‹¤.`,
              (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ ì´ê¸°ì ì¸ íƒœë„ì— ì‹¤ë§ê°ì„ ê°ì¶”ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`
          ]
      };

      const LOVER_EVENTS = [
          (a, b) => `${a}ì€(ëŠ”) ${b}ì—ê²Œ ëª°ëž˜ ìˆ¨ê²¨ë‘” ì´ˆì½œë¦¿ì„ ì£¼ë©° ì‚¬ëž‘ì„ ì†ì‚­ì˜€ìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ì¢€ë¹„ ë–¼ë¥¼ í”¼í•´ ìˆ¨ì€ ê³³ì—ì„œ ì†ì„ ê¼­ ìž¡ê³  ìžˆì—ˆìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì€(ëŠ”) ${b}ì„(ë¥¼) ìœ„í•´ ìžì‹ ì˜ ëª©ìˆ¨ì„ ê±¸ê³  ì•½ì„ êµ¬í•´ì™”ìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ì„¸ìƒì´ ëë‚˜ë”ë¼ë„ í•¨ê»˜í•˜ìžê³  ì•½ì†í–ˆìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì€(ëŠ”) ì•…ëª½ì„ ê¾¸ëŠ” ${b}ì„(ë¥¼) ë°¤ìƒˆ ì•ˆì•„ì£¼ì—ˆìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) íí—ˆ ì†ì—ì„œ ë‘˜ë§Œì˜ ìž‘ì€ ê²°í˜¼ì‹ì„ ìƒìƒí–ˆìŠµë‹ˆë‹¤.`
      ];

      const CONFESSION_EVENTS = [
          (a, b) => `${a}ì€(ëŠ”) ë–¨ë¦¬ëŠ” ëª©ì†Œë¦¬ë¡œ ${b}ì—ê²Œ ì¢‹ì•„í•œë‹¤ê³  ê³ ë°±í–ˆìŠµë‹ˆë‹¤!`,
          (a, b) => `${a}ì€(ëŠ”) ${b}ì—ê²Œ ê½ƒì„ ê±´ë„¤ë©° ë§ˆìŒì„ ì „í–ˆìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì€(ëŠ”) ${b}ì—ê²Œ "ë„ˆ ì—†ì´ëŠ” ì‚´ ìˆ˜ ì—†ì–´"ë¼ê³  ë§í–ˆìŠµë‹ˆë‹¤.`
      ];

      const BREAKUP_EVENTS = [
          (a, b) => `${a}ì™€(ê³¼) ${b}ì€(ëŠ”) ê·¹ì‹¬í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•´ ì„œë¡œì—ê²Œ ì”»ì„ ìˆ˜ ì—†ëŠ” ìƒì²˜ë¥¼ ì£¼ê³  í—¤ì–´ì¡ŒìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì€(ëŠ”) ${b}ì˜ ì´ê¸°ì ì¸ í–‰ë™ì— ì§ˆë ¤ ì´ë³„ì„ í†µë³´í–ˆìŠµë‹ˆë‹¤.`,
          (a, b) => `${a}ì™€(ê³¼) ${b}ì˜ ì‚¬ëž‘ì€ ì¢€ë¹„ ì•„í¬ì¹¼ë¦½ìŠ¤ì˜ í˜„ì‹¤ ì•žì—ì„œ ë¬´ë„ˆì ¸ ë‚´ë ¸ìŠµë‹ˆë‹¤.`
      ];

      const MBTI_SPECIFIC_ACTIONS = {
          INTJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ìž¥ê¸° ìƒì¡´ì„ ìœ„í•œ ë§ˆìŠ¤í„°í”Œëžœì„ ìˆ˜ë¦½í•˜ê³  ë¹„ìƒ ì‹ëŸ‰ì„ ìˆ¨ê²¼ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë¹„íš¨ìœ¨ì ì¸ ë°”ë¦¬ì¼€ì´ë“œë¥¼ ëœ¯ì–´ê³ ì¹˜ë‹¤ ì†ì„ ë‹¤ì³¤ì§€ë§Œ ë°©ì–´ë ¥ì€ ì˜¬ëžìŠµë‹ˆë‹¤.`, hp: -2, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ${p}ì˜ ëƒ‰ì² í•œ íŒë‹¨ìœ¼ë¡œ í•¨ì •ì„ ë¯¸ë¦¬ ê°ì§€í•˜ê³  í”¼í•´ê°”ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) í˜¼ìžë§Œì˜ ì‹œê°„ì„ ê°€ì§€ë©° ë³µìž¡í•œ ë¨¸ë¦¿ì†ì„ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ë“¤ì˜ ì´ë™ íŒ¨í„´ì—ì„œ ê·œì¹™ì„±ì„ ë°œê²¬í•˜ê³  ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë™ë£Œë“¤ì˜ ê°ì •ì ì¸ ê²°ì •ì´ ìƒì¡´ì— ë°©í•´ê°€ ëœë‹¤ê³  ë¹„íŒí–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ë¹—ë¬¼ì„ íš¨ìœ¨ì ìœ¼ë¡œ ëª¨ìœ¼ëŠ” ì •ìˆ˜ ì‹œìŠ¤í…œì„ ê³ ì•ˆí•´ëƒˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì²´ìŠ¤ ë§ì„ ê¹Žì•„ ë§Œë“¤ë©° ë‹¤ìŒ ìˆ˜ë¥¼ ìƒê°í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìž ì„ ì¤„ì—¬ê°€ë©° íƒˆì¶œìš© ì§€ë„ë¥¼ ì™„ë²½í•˜ê²Œ ì•”ê¸°í–ˆìŠµë‹ˆë‹¤.`, hp: -5, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) "ëª¨ë“  ê²ƒì€ ê³„íšëŒ€ë¡œì•¼"ë¼ê³  ì¤‘ì–¼ê±°ë ¸ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë¹„ìƒ ì‚¬íƒœë¥¼ ëŒ€ë¹„í•´ í”Œëžœ Dê¹Œì§€ ì„¸ì› ìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ë‚¨ë“¤ì´ ë³´ì§€ ëª»í•œ íƒˆì¶œ ë£¨íŠ¸ë¥¼ ë°œê²¬í•˜ê³  ì¡°ìš©ížˆ ë¯¸ì†Œ ì§€ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê°ì •ì— íœ©ì“¸ë¦¬ëŠ” ë™ë£Œë¥¼ ë³´ë©° ê³ ê°œë¥¼ ì €ì—ˆìŠµë‹ˆë‹¤.` }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          INTP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ ë°”ì´ëŸ¬ìŠ¤ì˜ ì›ì¸ì— ëŒ€í•´ ê¹Šê²Œ ê³ ì°°í•˜ë‹¤ ë¶ˆì¹¨ë²ˆ ì‹œê°„ì„ ë†“ì³¤ìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ìž¡ë™ì‚¬ë‹ˆë¥¼ ëª¨ì•„ ê¸°ë°œí•œ ì „ê¸° ì¶©ê²© í•¨ì •ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, kill: 1, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ì˜ í–‰ë™ ì–‘ì‹ì„ ê´€ì°°í•˜ë ¤ë‹¤ ë„ˆë¬´ ê°€ê¹Œì´ ë‹¤ê°€ê°€ ê³µê²©ë‹¹í–ˆìŠµë‹ˆë‹¤.`, hp: -10 },
                  { text: `${name}ì€(ëŠ”) ì§€ë„ì—ì„œ ëª¨ìˆœì ì„ ë°œê²¬í•˜ê³  ë” ì•ˆì „í•œ ê²½ë¡œë¥¼ ê³„ì‚°í•´ëƒˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ì“¸ëª¨ì—†ì–´ ë³´ì´ëŠ” ê¸°ê³„ë¥¼ ë¶„í•´í•˜ì—¬ ìœ ìš©í•œ ë¶€í’ˆì„ ì–»ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ë„ êµ¶ì–´ ì£½ì„ê¹Œì— ëŒ€í•œ ê°€ì„¤ì„ ì„¸ìš°ëŠë¼ ì‹ì‚¬í•˜ëŠ” ê²ƒì„ ìžŠì—ˆìŠµë‹ˆë‹¤.`, hp: -5 },
                  { text: `${name}ì€(ëŠ”) ë³µìž¡í•œ ì•”í˜¸ë¡œ ìž ê¸´ ë¬¸ì„ í•´ì œí•˜ëŠ” ë° ì„±ê³µí–ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ë¬´ì „ê¸°ë¥¼ ê°œì¡°í•˜ì—¬ ë” ë¨¼ ê³³ì˜ ì‹ í˜¸ë¥¼ ìž¡ìœ¼ë ¤ ì‹œë„í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ê°‘ìžê¸° ë– ì˜¤ë¥¸ ì•„ì´ë””ì–´ë¡œ ì¢€ë¹„ ìœ ì¸ìš© ë“œë¡ ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) í˜„ì‹¤ê°ì´ ì—†ì–´ì ¸ ì´ê²ƒì´ ì‹œë®¬ë ˆì´ì…˜ì¸ì§€ ì˜ì‹¬í•˜ê¸° ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) "ì´ ìƒí™©ì´ ë…¼ë¦¬ì ìœ¼ë¡œ ë§ì´ ì•ˆ ë¼"ë¼ë©° ë¶„ì„ì„ ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ì˜ ì•½ì ì„ íŒŒì•…í•˜ê¸° ìœ„í•´ ìœ„í—˜í•œ ì‹¤í—˜ì„ ê°í–‰í–ˆìŠµë‹ˆë‹¤.`, hp: -5, kill: 2 },
                  { text: `${name}ì€(ëŠ”) í˜¼ìžë§Œì˜ ì„¸ê³„ì— ë¹ ì ¸ ëˆ„ê°€ ë¶ˆëŸ¬ë„ ë“£ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ENTJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ìƒì¡´ìžë“¤ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì§€íœ˜í•˜ì—¬ ì™„ë²½í•œ ë°©ì–´ì„ ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìžì› í™•ë³´ë¥¼ ìœ„í•´ ìœ„í—˜í•œ ì›ì •ì„ ê°•í–‰í–ˆìŠµë‹ˆë‹¤.`, hp: -5, kill: 2 },
                  { text: `${name}ì€(ëŠ”) ë‚˜ì•½í•œ ì†Œë¦¬ë¥¼ í•˜ëŠ” ë™ë£Œë¥¼ ê°•í•˜ê²Œ ì§ˆì±…í•˜ì—¬ ë¶„ìœ„ê¸°ë¥¼ ì–¼ì–´ë¶™ê²Œ í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ìƒˆë¡œìš´ ê±°ì ì„ í™•ë³´í•˜ê¸° ìœ„í•œ ëŒ€ë‹´í•œ ì „ëžµì„ ì§°ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë¦¬ë”ì‹­ì„ ë°œíœ˜í•˜ì—¬ í­ë™ ì¡°ì§ì„ ì‚¬ì „ì— ì œì••í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì“¸ëª¨ì—†ëŠ” ì§ì„ ë²„ë¦¬ê³  ì´ë™ ì†ë„ë¥¼ ë†’ì´ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ê°ì—¼ ì˜ì‹¬ìžë¥¼ ê²©ë¦¬í•´ì•¼ í•œë‹¤ê³  ëƒ‰ì •í•˜ê²Œ ì£¼ìž¥í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ì£¼ë³€ ì§€í˜•ì„ ì™„ì „ížˆ ìž¥ì•…í•˜ê³  ìš”ìƒˆí™” ê³„íšì„ ì„¸ì› ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì‹ëŸ‰ ë°°ê¸‰ í†µì œê¶Œì„ ì¥ê³  ì² ì €í•˜ê²Œ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ì„ ë‘ì— ì„œì„œ ì¢€ë¹„ ë¬´ë¦¬ë¥¼ ëš«ê³  ê¸¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤.`, hp: -5, kill: 3 },
                  { text: `${name}ì€(ëŠ”) ë¹„íš¨ìœ¨ì ì¸ í–‰ë™ì„ í•˜ëŠ” ë™ë£Œì—ê²Œ ì—…ë¬´ë¥¼ ìž¬ë°°ë‹¹í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ë¯¸ëž˜ë¥¼ ìœ„í•´ ì¸ìž¬ ì–‘ì„±ì´ í•„ìš”í•˜ë‹¤ë©° ìƒì¡´ ê¸°ìˆ ì„ ê°€ë¥´ì³¤ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ìžì‹ ì˜ ëª…ë ¹ì— ë¶ˆë³µì¢…í•˜ëŠ” ê²ƒì„ ìš©ë‚©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`, sanity: -5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ENTP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ë¥¼ ìœ ì¸í•˜ëŠ” ìœ„í—˜í•˜ì§€ë§Œ ê¸°ë°œí•œ ë°©ë²•ì„ ì‹œí—˜í–ˆìŠµë‹ˆë‹¤.`, hp: -5, kill: 3 },
                  { text: `${name}ì€(ëŠ”) ì ˆë§ì ì¸ ìƒí™©ì—ì„œë„ ë†ë‹´ì„ ë˜ì ¸ ë¶„ìœ„ê¸°ë¥¼ í™˜ê¸°í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) "ì¢€ë¹„ë„ ìˆ˜ì˜ì„ í•  ìˆ˜ ìžˆì„ê¹Œ?"ë¼ëŠ” ì—‰ëš±í•œ í† ë¡ ì„ ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ì¦‰í¥ì ìœ¼ë¡œ ë§Œë“  ë¬´ê¸°ë¡œ ìœ„ê¸°ë¥¼ ëª¨ë©´í–ˆìŠµë‹ˆë‹¤.`, kill: 1 },
                  { text: `${name}ì€(ëŠ”) ê¸°ì¡´ì˜ ìƒì¡´ ìˆ˜ì¹™ì— ì˜ë¬¸ì„ ì œê¸°í•˜ë©° ìƒˆë¡œìš´ ë°©ë²•ì„ ì œì•ˆí–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ í•œ ë§ˆë¦¬ë¥¼ ìƒí¬í•´ì„œ ê¸¸ë“¤ì´ë ¤ë‹¤ í˜¼ë‚  ë»”í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ì ëŒ€ì ì¸ ìƒì¡´ìž ê·¸ë£¹ì—ê²Œ ë§ë¹¨ë¡œ ì‚¬ê¸°ë¥¼ ì³ì„œ ë¬¼ìžë¥¼ ì–»ì–´ëƒˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) í­ë°œë¬¼ì„ ì œì¡°í•˜ì—¬ í™”ë ¤í•œ ë¶ˆê½ƒë†€ì´ë¥¼ ê³„íší–ˆìŠµë‹ˆë‹¤.`, hp: -5, kill: 5 },
                  { text: `${name}ì€(ëŠ”) ì•…ë§ˆì˜ ëŒ€ë³€ì¸ ì—­í• ì„ ìžì²˜í•˜ë©° íšŒì˜ë¥¼ ê¸¸ì–´ì§€ê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ì´ìƒí•œ ìž¬ë£Œë¥¼ ì„žì–´ ìƒˆë¡œìš´ ì—ë„ˆì§€ ë“œë§í¬ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, hp: -2 },
                  { text: `${name}ì€(ëŠ”) ìœ„ê¸° ìƒí™©ì„ ê²Œìž„ì²˜ëŸ¼ ì¦ê¸°ë©° ëŒ€ë‹´í•˜ê²Œ í–‰ë™í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì•„ë¬´ë„ ìƒê°í•˜ì§€ ëª»í•œ ê¸°ìƒì²œì™¸í•œ íƒˆì¶œë²•ì„ ìƒê°í•´ëƒˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì§€ë£¨í•˜ë‹¤ë©° ì¼ë¶€ëŸ¬ ìœ„í—˜í•œ ë‚´ê¸°ë¥¼ ì œì•ˆí–ˆìŠµë‹ˆë‹¤.`, hp: -2 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          INFJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ì•…ëª½ì„ ê¾¸ì—ˆì§€ë§Œ, ê·¸ê²ƒì´ ë¶ˆê¸¸í•œ ì˜ˆì§€ëª½ì´ë¼ ëŠê¼ˆìŠµë‹ˆë‹¤.`, sanity: -10 },
                  { text: `${name}ì€(ëŠ”) ì ˆë§ì— ë¹ ì§„ ë™ë£Œë¥¼ ì¡°ìš©ížˆ ìœ„ë¡œí•˜ë©° ìƒë‹´í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê·¸ë£¹ì„ ìœ„í•´ ëª°ëž˜ ìžì‹ ì˜ ëª«ì¸ ì‹ëŸ‰ì„ ì–‘ë³´í–ˆìŠµë‹ˆë‹¤.`, hp: -5, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ê°€ ëœ ì˜› ì´ì›ƒì„ ë³´ê³  ê¹Šì€ ìŠ¬í””ì— ìž ê²¼ìŠµë‹ˆë‹¤.`, sanity: -15 },
                  { text: `${name}ì€(ëŠ”) ì¸ê°„ì„±ì„ ìžƒì§€ ì•Šê¸° ìœ„í•´ ì² í•™ì ì¸ ê³ ë¯¼ì„ í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë‹¤ê°€ì˜¬ ìœ„ê¸°ë¥¼ ì§ê°í•˜ê³  ë¯¸ë¦¬ í”¼ë‚œ ì§ì„ ìŒŒìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ê·¸ë£¹ ë‚´ì˜ ë³´ì´ì§€ ì•ŠëŠ” ê°ˆë“±ì„ ê°ì§€í•˜ê³  í•´ê²°í•˜ë ¤ ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìžì‹ ì„ í¬ìƒí•´ì„œë¼ë„ ì•„ì´ë“¤ì„ ì§€í‚¤ê² ë‹¤ê³  ë‹¤ì§í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¡°ìš©í•œ ê³³ì—ì„œ ëª…ìƒì„ í•˜ë©° ë§ˆìŒì„ ë‹¤ìŠ¤ë ¸ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ëˆ„êµ°ê°€ì˜ ê±°ì§“ë§ì„ ëˆˆì¹˜ì±˜ì§€ë§Œ ëª¨ë¥¸ ì²™ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ë§í•˜ì§€ ì•Šì•„ë„ ë™ë£Œì˜ ì•„í””ì„ ì•Œì•„ì±„ê³  ê³ì„ ì§€ì¼°ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì„¸ìƒì´ ë©¸ë§í•´ë„ ì§€ì¼œì•¼ í•  ê°€ì¹˜ê°€ ìžˆë‹¤ê³  ë¯¿ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) í˜¼ëž€ìŠ¤ëŸ¬ìš´ ìƒí™© ì†ì—ì„œë„ í‰ì •ì‹¬ì„ ìœ ì§€í•˜ë ¤ ì• ì¼ìŠµë‹ˆë‹¤.`, sanity: -2 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          INFP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) íí—ˆ ì†ì—ì„œë„ í”¼ì–´ë‚œ ê½ƒì„ ë³´ê³  í¬ë§ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) í˜„ì‹¤ì˜ ì°¸í˜¹í•¨ì„ ê²¬ë””ì§€ ëª»í•˜ê³  êµ¬ì„ì— ìˆ¨ì–´ë²„ë ¸ìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ë‚¡ì€ ì¼ê¸°ìž¥ì— í˜„ìž¬ì˜ ê°ì •ì„ ì‹œë¡œ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë‹¤ì¹œ ê¸¸ê³ ì–‘ì´ë¥¼ ì¹˜ë£Œí•˜ë ¤ë‹¤ ê¸í˜”ìŠµë‹ˆë‹¤.`, hp: -2 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ê°€ í–‰ë³µí•˜ê²Œ ì‚¬ëŠ” ì´ìƒì ì¸ ì€ì‹ ì²˜ë¥¼ ìƒìƒí–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ì†Œì¤‘í•œ ë¬¼ê±´ì„ ìžƒì–´ë²„ë¦¬ê³  í•˜ë£¨ ì¢…ì¼ ìš°ìš¸í•´í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ì—ê²Œë„ ì˜í˜¼ì´ ë‚¨ì•„ìžˆì„ì§€ ëª¨ë¥¸ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ìˆ²ì†ì˜ ìž‘ì€ ì˜¤ë‘ë§‰ì„ ë°œê²¬í•˜ê³  ê·¸ê³³ì—ì„œ ì‚´ê³  ì‹¶ì–´í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì‹¸ì›€ì„ í”¼í•˜ê¸° ìœ„í•´ ìžì‹ ì˜ ì˜ê²¬ì„ ìˆ¨ê²¼ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ìš°ì—°ížˆ ë°œê²¬í•œ ì±… í•œ ê¶Œì— ê¹Šì´ ë¹ ì ¸ë“¤ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì•„ë¬´ë„ ì—†ëŠ” ê³³ì—ì„œ ì¡°ìš©ížˆ ëˆˆë¬¼ì„ í˜ë ¸ìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ì•„ë¦„ë‹¤ìš´ ë…¸ì„ì„ ë³´ë©° ìž ì‹œ ëª¨ë“  ì‹œë¦„ì„ ìžŠì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì‚­ë§‰í•œ ì„¸ìƒì—ì„œë„ ìžì‹ ë§Œì˜ ë‚­ë§Œì„ ì°¾ìœ¼ë ¤ í–ˆìŠµë‹ˆë‹¤.` }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ENFJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ì˜ ì‚¬ê¸°ë¥¼ ë¶ë‹ìš°ê¸° ìœ„í•´ ì—´ì •ì ì¸ ì—°ì„¤ì„ í–ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê°ˆë“±ì´ ìƒê¸´ ìƒì¡´ìžë“¤ ì‚¬ì´ë¥¼ ì¤‘ìž¬í•˜ì—¬ í™”í•´ì‹œì¼°ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë™ë£Œë¥¼ êµ¬í•˜ê¸° ìœ„í•´ ìœ„í—˜ì„ ë¬´ë¦…ì“°ê³  ë›°ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤.`, hp: -15, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê·¸ë£¹ì˜ í™”í•©ì„ ìœ„í•´ ìž‘ì€ ìº í”„íŒŒì´ì–´ ìžë¦¬ë¥¼ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) íƒ€ì¸ì˜ ê³ í†µì„ ìžì‹ ì˜ ê²ƒì²˜ëŸ¼ ëŠê»´ ê´´ë¡œì›Œí–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ë‚¯ì„  ìƒì¡´ìžë¥¼ ë°œê²¬í•˜ê³  ê·¸ë¥¼ ê·¸ë£¹ì— ë°›ì•„ë“¤ì—¬ì•¼ í•œë‹¤ê³  ì„¤ë“í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ì—ê²Œ ì—­í• ì„ ë¶€ì—¬í•˜ì—¬ ì†Œì†ê°ì„ ëŠë¼ê²Œ í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë¦¬ë”ì˜ ë¶€ë‹´ê° ë•Œë¬¸ì— ë‚¨ëª°ëž˜ íž˜ë“¤ì–´í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ì£½ì€ ë™ë£Œë¥¼ ìœ„í•´ ìž‘ì€ ìž¥ë¡€ì‹ì„ ì¹˜ëŸ¬ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì´ê¸°ì ì¸ í–‰ë™ì„ í•˜ëŠ” ì‚¬ëžŒì—ê²Œ í¬ê²Œ ì‹¤ë§í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) "ìš°ë¦° í•  ìˆ˜ ìžˆì–´!"ë¼ë©° ëŠìž„ì—†ì´ ê²©ë ¤í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìžì‹ ì˜ ì•ˆìœ„ë³´ë‹¤ ì§‘ë‹¨ì˜ ì´ìµì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë”°ëœ»í•œ ë§ í•œë§ˆë””ë¡œ ì–¼ì–´ë¶™ì€ ë¶„ìœ„ê¸°ë¥¼ ë…¹ì˜€ìŠµë‹ˆë‹¤.`, sanity: 5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ENFP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ë²„ë ¤ì§„ ì•…ê¸°ë¥¼ ë°œê²¬í•˜ê³  ì„œíˆ° ì—°ì£¼ë¥¼ ì‹œìž‘í–ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ì¶©ë™ì ìœ¼ë¡œ ë‚¯ì„  ê±´ë¬¼ì— ë“¤ì–´ê°”ë‹¤ê°€ ëœ»ë°–ì˜ ë¬¼ìžë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ ì•„í¬ì¹¼ë¦½ìŠ¤ ì´í›„ì˜ ì„¸ìƒì„ ê¸ì •ì ìœ¼ë¡œ ìƒìƒí•˜ë©° ì´ì•¼ê¸°í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) í•œ ê³³ì— ë¨¸ë¬´ë¥´ëŠ” ê²ƒì„ ë‹µë‹µí•´í•˜ë©° ìœ„í—˜í•œ ì •ì°°ì„ ìžì²˜í–ˆìŠµë‹ˆë‹¤.`, hp: -5 },
                  { text: `${name}ì€(ëŠ”) íŠ¹ì´í•œ ìž¥ë‚œê°ì„ ì£¼ì›Œì™€ì„œ ëª¨ë‘ì—ê²Œ ë³´ì—¬ì£¼ë©° ì›ƒì—ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ìš°ìš¸í•´í•˜ëŠ” ì¹œêµ¬ë¥¼ ìœ„í•´ ê¹œì§ ì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) í˜¸ê¸°ì‹¬ì„ ì°¸ì§€ ëª»í•˜ê³  ê¸ˆì§€ëœ êµ¬ì—­ì— ë“¤ì–´ê°”ë‹¤ ì™”ìŠµë‹ˆë‹¤.`, hp: -2, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ ë¶„ìž¥ì„ í•˜ê³  ë™ë£Œë¥¼ ë†€ëž˜í‚¤ë‹¤ ë§žì„ ë»”í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) "ìš°ë¦° ë°˜ë“œì‹œ ì‚´ì•„ì„œ ë°”ë‹¤ë¥¼ ë³´ëŸ¬ ê°ˆ ê±°ì•¼!"ë¼ê³  ì™¸ì³¤ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê°ì • ê¸°ë³µì´ ì‹¬í•´ì ¸ì„œ ìš¸ë‹¤ê°€ ì›ƒë‹¤ê°€ í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ê¸°ë°œí•œ ì•„ì´ë””ì–´ë¡œ ê³ ìž¥ ë‚œ ìž¥ë¹„ë¥¼ ê³ ì³¤ìŠµë‹ˆë‹¤(ì•„ë§ˆë„ ìš´ìœ¼ë¡œ).`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìƒˆë¡œìš´ ì‚¬ëžŒì„ ë§Œë‚˜ìžë§ˆìž ì¹œêµ¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìŸì•„ì§€ëŠ” ë¹„ë¥¼ ë§žìœ¼ë©° ì¶¤ì„ ì¶”ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ISTJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ìž¬ê³  ì¡°ì‚¬ë¥¼ ì² ì €ížˆ í•˜ì—¬ ì‹ëŸ‰ì´ ë¶€ì¡±í•¨ì„ ì •í™•ížˆ ì•Œë ¸ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì •í•´ì§„ ìˆ˜ì¹™ëŒ€ë¡œ í•œì¹˜ì˜ ì˜¤ì°¨ë„ ì—†ì´ ê²½ê³„ ê·¼ë¬´ë¥¼ ì„°ìŠµë‹ˆë‹¤.`, sanity: 0 },
                  { text: `${name}ì€(ëŠ”) ë¬´ì§ˆì„œí•˜ê³  ê³„íš ì—†ëŠ” ìƒí™©ì— ê·¹ì‹¬í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ê³¼ê±°ì˜ ê²½í—˜ì„ ë˜ì‚´ë ¤ ì˜¤ëž˜ëœ ë°œì „ê¸°ë¥¼ ìˆ˜ë¦¬í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì•ˆì „ì´ í™•ì¸ëœ ê²½ë¡œë§Œì„ ê³ ì§‘í•˜ì—¬ ì´ë™ ì‹œê°„ì„ ì§€ì²´ì‹œì¼°ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) íƒ„ì•½ ìˆ˜ë¥¼ í•˜ë‚˜í•˜ë‚˜ ì„¸ì–´ ìž¥ë¶€ì— ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ì•½ì†ëœ ì‹œê°„ì„ ì§€í‚¤ì§€ ì•Šì€ ë™ë£Œì—ê²Œ ìž”ì†Œë¦¬ë¥¼ í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ë¶€ì‹¤í•œ ë²½ì„ í•˜ë£¨ ì¢…ì¼ ë³´ê°• ê³µì‚¬í–ˆìŠµë‹ˆë‹¤.`, hp: -2, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë§Œì•½ì˜ ì‚¬íƒœë¥¼ ëŒ€ë¹„í•´ í”Œëžœ B, Cê¹Œì§€ ì„¸ì›Œë‘ì—ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ê°ì •ì— íœ˜ë‘˜ë¦¬ì§€ ì•Šê³  ëƒ‰ì •í•˜ê²Œ ì¢€ë¹„ë¥¼ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤.`, kill: 1 },
                  { text: `${name}ì€(ëŠ”) ìœ í†µê¸°í•œì´ ì§€ë‚œ ì•½í’ˆì„ ë¶„ë¥˜í•˜ì—¬ íê¸°í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ì •í•´ì§„ ì‹ì‚¬ëŸ‰ì„ ì •í™•í•˜ê²Œ ë°°ë¶„í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ííŠ¸ëŸ¬ì§„ ì§ì„ ë‹¤ì‹œ ì •ë¦¬í•˜ë©° ë§ˆìŒì˜ ì•ˆì •ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.`, sanity: 5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ISFJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ë¶€ìƒë‹¹í•œ ë™ë£Œë“¤ì˜ ìƒì²˜ë¥¼ ì •ì„±ê» ì†Œë…í•˜ê³  ëŒë´¤ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ê°€ ìž ë“  ì‚¬ì´ ì¡°ìš©ížˆ ì£¼ë³€ì„ ì²­ì†Œí•˜ê³  ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìžƒì–´ë²„ë¦° ê°€ì¡±ì˜ ì‚¬ì§„ì„ ë³´ë©° ëˆˆë¬¼ì„ í˜ë ¸ìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) êµ¬í•  ìˆ˜ ìžˆëŠ” ìž¬ë£Œë¡œ ë”°ëœ»í•œ ìŠ¤íŠœë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, hp: 5 },
                  { text: `${name}ì€(ëŠ”) ìœ„ê¸°ì˜ ìˆœê°„ ìžì‹ ì˜ ì•ˆìœ„ë³´ë‹¤ ë™ë£Œì˜ ë°©íŒ¨ê°€ ë˜ê¸°ë¥¼ ìžì²˜í–ˆìŠµë‹ˆë‹¤.`, hp: -10 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ì˜ ìƒì¼ì„ ê¸°ì–µí•˜ê³  ìž‘ì€ ì„ ë¬¼ì„ ì±™ê²¨ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê±°ì ˆì„ ëª»í•´ì„œ ìžì‹ ì˜ ëª«ë³´ë‹¤ ë” ë§Žì€ ì¼ì„ ë– ë§¡ì•˜ìŠµë‹ˆë‹¤.`, hp: -5, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) êµ¬ì„ì— í•€ ì•¼ìƒí™”ë¥¼ êº¾ì–´ í…Œì´ë¸”ì„ ìž¥ì‹í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ë‹¤íˆ° ì‚¬ëžŒë“¤ ì‚¬ì´ì—ì„œ ëˆˆì¹˜ë¥¼ ë³´ë©° ì–´ì©” ì¤„ ëª°ë¼í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ê³¼ê±°ì˜ í‰í™”ë¡œì› ë˜ ì‹œì ˆì„ íšŒìƒí•˜ë©° ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë™ë£Œê°€ ìž ë“¤ ë•Œê¹Œì§€ ê³ì—ì„œ ì§€ì¼œì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìžì‹ ì˜ ì‹ëŸ‰ì„ ëª°ëž˜ ë°°ê³ í”ˆ ë™ë£Œ ê°€ë°©ì— ë„£ì–´ë‘ì—ˆìŠµë‹ˆë‹¤.`, hp: -2, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ëˆ„êµ°ê°€ì˜ ê±°ì¹œ ë§ì— ìƒì²˜ë°›ì•˜ì§€ë§Œ ë‚´ìƒ‰í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`, sanity: -5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ESTJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ìº í”„ì˜ ë³´ì•ˆ ìƒíƒœë¥¼ ì ê²€í•˜ê³  ì¦‰ê°ì ì¸ ë³´ê°• ê³µì‚¬ë¥¼ ì§€ì‹œí–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê²Œìœ¼ë¦„ì„ í”¼ìš°ëŠ” ë™ë£Œì—ê²Œ ë”°ë”í•˜ê²Œ í›ˆê³„ë¥¼ í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) íš¨ìœ¨ì ì¸ ì¢€ë¹„ ì²˜ë¦¬ ë©”ë‰´ì–¼ì„ ë§Œë“¤ê³  í›ˆë ¨ì‹œì¼°ìŠµë‹ˆë‹¤.`, kill: 2 },
                  { text: `${name}ì€(ëŠ”) ì „í†µì ì¸ ë°©ì‹ì˜ í›ˆì œ ë³´ì¡´ì‹ì„ ë§Œë“¤ì–´ ì‹ëŸ‰ì„ ë¹„ì¶•í–ˆìŠµë‹ˆë‹¤.`, hp: 5 },
                  { text: `${name}ì€(ëŠ”) ê·¸ë£¹ì˜ ê·œìœ¨ì„ í™•ë¦½í•˜ê¸° ìœ„í•´ ê¸´ê¸‰ íšŒì˜ë¥¼ ì†Œì§‘í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ì‹ëŸ‰ ë°°ê¸‰ ì›ì¹™ì„ ì—„ê²©í•˜ê²Œ ì ìš©í•˜ì—¬ ë¶ˆë§Œì„ ìƒ€ìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ì¡°ì§ì ì¸ ìˆ˜ìƒ‰ ìž‘ì „ì„ íŽ¼ì³ ë§Žì€ ë¬¼ìžë¥¼ í™•ë³´í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê¶Œìœ„ì— ë„ì „í•˜ëŠ” ì‚¬ëžŒê³¼ ì¶©ëŒí–ˆìŠµë‹ˆë‹¤.`, hp: -2, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ê°€ ìž ë“  ìƒˆë²½, í™€ë¡œ ìž¥ë¹„ ì ê²€ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) "ìš°ë¦¬ëŠ” ì‚´ì•„ë‚¨ì•„ì•¼ í•  ì˜ë¬´ê°€ ìžˆë‹¤"ê³  ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ê°ì—¼ ì˜ˆë°© ìˆ˜ì¹™ì„ ì–´ê¸´ ì‚¬ëžŒì„ ê²©ë¦¬ ì¡°ì¹˜í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë“  ê²°ì •ì— ì±…ìž„ì„ ì§€ë©° ì•žìž¥ì„°ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) í˜¼ëž€ìŠ¤ëŸ¬ìš´ ìƒí™©ì„ í†µì œí•˜ë©° ì§ˆì„œë¥¼ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ESFJ: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ìƒì¡´ìžë“¤ì˜ ìƒì¼ì„ ê¸°ì–µí•´ë‚´ê³  ìž‘ê²Œë‚˜ë§ˆ ì¶•í•˜í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ì˜ ìƒíƒœë¥¼ ì¼ì¼ì´ í™•ì¸í•˜ë©° ì•ˆë¶€ë¥¼ ë¬¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê·¸ë£¹ ë‚´ì˜ ë¶ˆí™”ë¥¼ ìž ìž¬ìš°ê¸° ìœ„í•´ ë™ë¶„ì„œì£¼í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ëˆ„êµ°ê°€ ìžì‹ ì„ ì†Œì™¸ì‹œí‚¨ë‹¤ê³  ëŠê»´ ìš°ìš¸í•´í–ˆìŠµë‹ˆë‹¤.`, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ë³´ê¸‰í’ˆì„ ê³µí‰í•˜ê²Œ ë‚˜ëˆ„ì–´ ì£¼ë©° ë¶ˆë§Œì„ ìž ìž¬ì› ìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë¹¨ëž˜ë¥¼ ëª¨ì•„ ì„¸íƒí•˜ë©° ìœ„ìƒì„ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) íž˜ë“¤ì–´í•˜ëŠ” ë™ë£Œì˜ ì†ì„ ìž¡ê³  ëê¹Œì§€ ë“¤ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì‚¬ì†Œí•œ ì†Œë¬¸ì„ í¼ëœ¨ë ¤ ë¶„ìœ„ê¸°ë¥¼ ë¬˜í•˜ê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ê°€ ëª¨ì—¬ ì‹ì‚¬í•˜ëŠ” ì‹œê°„ì„ ì¤‘ìš”í•˜ê²Œ ì—¬ê²¼ìŠµë‹ˆë‹¤.`, hp: 2 },
                  { text: `${name}ì€(ëŠ”) "ìš°ë¦¬ ëª¨ë‘ ë‹¤ ê°™ì´ ì‚´ì•„ì•¼ í•´"ë¼ë©° íŒ€ì›Œí¬ë¥¼ ê°•ì¡°í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë§›ì—†ëŠ” ë¹„ìƒì‹ëŸ‰ì„ ì–´ë–»ê²Œë“  ë§›ìžˆê²Œ ìš”ë¦¬í•˜ë ¤ ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê·¸ë£¹ì˜ ì‚¬ê¸°ë¥¼ ìœ„í•´ ìž¬ë¯¸ìžˆëŠ” ì´ì•¼ê¸°ë¥¼ ì£¼ë„í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ëˆ„êµ°ê°€ê°€ ìžì‹ ì„ ì‹«ì–´í• ê¹Œ ë´ ì „ì „ê¸ê¸í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ISTP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ê³ ìž¥ë‚œ ì°¨ëŸ‰ì„ ìˆ˜ë¦¬í•˜ì—¬ ì´ë™ ìˆ˜ë‹¨ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ì‡ íŒŒì´í”„ë¥¼ ê¹Žì•„ ë‚ ì¹´ë¡œìš´ ì°½ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, kill: 1 },
                  { text: `${name}ì€(ëŠ”) í˜¼ìž ì •ì°°ì„ ë‚˜ê°”ë‹¤ê°€ ì¢€ë¹„ ë¬´ë¦¬ë¥¼ ë”°ëŒë¦¬ê³  ë¬´ì‚¬ížˆ ëŒì•„ì™”ìŠµë‹ˆë‹¤.`, hp: -2, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë³µìž¡í•œ ê°ì • ì‹¸ì›€ì— íœ˜ë§ë¦¬ê¸° ì‹«ì–´ ìžë¦¬ë¥¼ í”¼í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ìœ„ê¸°ì˜ ìˆœê°„ ë†€ë¼ìš´ ë°˜ì‚¬ì‹ ê²½ìœ¼ë¡œ ì¢€ë¹„ì˜ ë¨¸ë¦¬ë¥¼ ë‚ ë ¸ìŠµë‹ˆë‹¤.`, kill: 3 },
                  { text: `${name}ì€(ëŠ”) ê°€ìž¥ íš¨ìœ¨ì ì¸ ì‚´ìƒ ë°©ë²•ì„ ì—°êµ¬í–ˆìŠµë‹ˆë‹¤.`, kill: 2 },
                  { text: `${name}ì€(ëŠ”) ë§ì—†ì´ êµ¬ì„ì—ì„œ ê³ ìž¥ ë‚œ ë¼ë””ì˜¤ë¥¼ ê³ ì³¤ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì§€ë£¨í•¨ì„ ì°¸ì§€ ëª»í•˜ê³  í˜¼ìž ìœ„í—˜í•œ ìŠ¤í„´íŠ¸ë¥¼ ê°í–‰í–ˆìŠµë‹ˆë‹¤.`, hp: -5 },
                  { text: `${name}ì€(ëŠ”) ìƒí™©ì„ ë¶„ì„í•˜ê¸°ë³´ë‹¤ ëª¸ìœ¼ë¡œ ë¶€ë”ªí˜€ í•´ê²°í–ˆìŠµë‹ˆë‹¤.`, kill: 1 },
                  { text: `${name}ì€(ëŠ”) í•„ìš”í•œ ë§ë§Œ ê³¨ë¼ì„œ í•˜ì—¬ ì—ë„ˆì§€ë¥¼ ì•„ê¼ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë¹ˆ ë³‘ì„ ì´ìš©í•´ ì†ŒìŒê¸°ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, kill: 1 },
                  { text: `${name}ì€(ëŠ”) ë‹«ížŒ ê¸ˆê³ ë¥¼ ì˜·í•€ í•˜ë‚˜ë¡œ ì—´ì–´ ì‚¬ëžŒë“¤ì„ ë†€ë¼ê²Œ í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë§¨ì†ìœ¼ë¡œ ë¬¼ê³ ê¸°ë¥¼ ìž¡ì•„ì™€ ì €ë… ê±°ë¦¬ë¥¼ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤.`, hp: 5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ISFP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ë²½ì— ê·¸ë¦¼ì„ ê·¸ë¦¬ë©° ì‚­ë§‰í•œ ê³³ì—ì„œ ë§ˆìŒì˜ í‰í™”ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê°‘ìžê¸° ë‚˜íƒ€ë‚œ ì¢€ë¹„ì—ê²Œì„œ ìˆ¨ë§‰ížˆëŠ” ì€ì‹  ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìˆ²ì†ì—ì„œ ë¨¹ì„ ìˆ˜ ìžˆëŠ” ì—´ë§¤ë¥¼ ì°¾ì•„ì™”ìŠµë‹ˆë‹¤.`, hp: 5 },
                  { text: `${name}ì€(ëŠ”) ê³„ì†ë˜ëŠ” ê°ˆë“± ìƒí™©ì„ ê²¬ë””ì§€ ëª»í•˜ê³  ë›°ì³ë‚˜ê°ˆ ë»”í–ˆìŠµë‹ˆë‹¤.`, sanity: -10 },
                  { text: `${name}ì€(ëŠ”) ${p}ì˜ ë…íŠ¹í•œ ê°ê°ìœ¼ë¡œ ì£¼ë³€ ì§€í˜•ì§€ë¬¼ì„ ì´ìš©í•œ ìœ„ìž¥ë§‰ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë‹¤ì¹œ ì‚¬ìŠ´ì„ ë°œê²¬í•˜ê³  ì¹˜ë£Œí•´ì£¼ë ¤ ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë¬´ê¸°ë¥¼ ì•„ë¦„ë‹µê²Œ ìž¥ì‹í•˜ë©° ì‹œê°„ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ì•„ë¬´ë„ ëª¨ë¥´ê²Œ ì¢€ë¹„ í•œ ë§ˆë¦¬ë¥¼ ì¡°ìš©ížˆ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤.`, kill: 1 },
                  { text: `${name}ì€(ëŠ”) ìŸì•„ì§€ëŠ” ë³„ì„ ë³´ë©° ëˆˆë¬¼ì„ í˜ë ¸ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ìžì‹ ì˜ ê°€ì¹˜ê´€ì— ì–´ê¸‹ë‚˜ëŠ” ëª…ë ¹ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ë™ë¬¼ì˜ ë¼ˆë¡œ ìž‘ì€ ìž¥ì‹ êµ¬ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ì˜ˆê¸°ì¹˜ ëª»í•œ ìˆœê°„ì— ìš©ê¸°ë¥¼ ë°œíœ˜í•´ ë™ë£Œë¥¼ êµ¬í–ˆìŠµë‹ˆë‹¤.`, hp: -5, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¡°ìš©ížˆ ì½§ë…¸ëž˜ë¥¼ í¥ì–¼ê±°ë ¤ ì£¼ë³€ì„ ì•ˆì‹¬ì‹œì¼°ìŠµë‹ˆë‹¤.` }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ESTP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ìœ„í—˜í•œ ìƒí™©ì„ ì¦ê¸°ë©° ì¢€ë¹„ì™€ ì¶”ê²©ì „ì„ ë²Œì˜€ìŠµë‹ˆë‹¤.`, hp: -10, kill: 2 },
                  { text: `${name}ì€(ëŠ”) ëˆ„ê°€ ë” ë§Žì€ ì¢€ë¹„ë¥¼ ìž¡ë‚˜ ë‚´ê¸°ë¥¼ ê±¸ì–´ ì‹ëŸ‰ì„ ë”°ëƒˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì§ê´€ì ì¸ íŒë‹¨ìœ¼ë¡œ ë¬´ë„ˆì§€ëŠ” ê±´ë¬¼ì—ì„œ ê°€ìž¥ ë¨¼ì € íƒˆì¶œí–ˆìŠµë‹ˆë‹¤.`, hp: -2 },
                  { text: `${name}ì€(ëŠ”) ë‹µë‹µí•¨ì„ ì°¸ì§€ ëª»í•˜ê³  ì˜¤í† ë°”ì´ë¥¼ ì°¾ì•„ ì£¼ë³€ì„ ì§ˆì£¼í–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì¦‰ì„ì—ì„œ í™”ì—¼ë³‘ì„ ë§Œë“¤ì–´ ì¢€ë¹„ ë¬´ë¦¬ì— ë˜ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤.`, kill: 5 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ ë–¼ í•œê°€ìš´ë°ë¡œ ë›°ì–´ë“¤ì–´ ë¬´ìŒì„ ì°ì—ˆìŠµë‹ˆë‹¤.`, hp: -20, kill: 10 },
                  { text: `${name}ì€(ëŠ”) ìš°ì—°ížˆ ë°œê²¬í•œ ìˆ ì„ ë§ˆì‹œë©° í˜¸íƒ•í•˜ê²Œ ì›ƒì—ˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê³„íšë³´ë‹¤ëŠ” ìž„ê¸°ì‘ë³€ìœ¼ë¡œ ìœ„ê¸°ë¥¼ ëª¨ë©´í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ì§€ë£¨í•˜ë‹¤ë©° ìœ„í—˜í•œ ì‚¬ê²© ì—°ìŠµì„ ì œì•ˆí–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) í˜‘ìƒë³´ë‹¤ëŠ” ì£¼ë¨¹ì´ ë¹ ë¥´ë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì£¼ì—ˆìŠµë‹ˆë‹¤.`, hp: -5 },
                  { text: `${name}ì€(ëŠ”) ë²„ë ¤ì§„ ìŠ¤í¬ì¸ ì¹´ë¥¼ ë°œê²¬í•˜ê³  í™˜í˜¸ì„±ì„ ì§ˆë €ìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ë²Œë ˆë¥¼ ìž¡ì•„ë¨¹ëŠ” ë‚´ê¸°ë¥¼ í•˜ì—¬ ì‚¬ëžŒë“¤ì„ ê²½ì•…í•˜ê²Œ í–ˆìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ìœ„í—˜í•œ êµ¬ì—­ì— ê°€ìž¥ ë¨¼ì € ë›°ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤.`, hp: -5 }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          },
          ESFP: (name, gender) => {
              const p = getPronoun(gender);
              const actions = [
                  { text: `${name}ì€(ëŠ”) ì¶¤ê³¼ ë…¸ëž˜ë¡œ ì¹™ì¹™í•œ ìº í”„ì˜ ë¶„ìœ„ê¸°ë¥¼ ë°˜ì „ì‹œì¼°ìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ì¶©ë™ì ìœ¼ë¡œ ë‹«ížŒ ë¬¸ì„ ì—´ì—ˆë‹¤ê°€ ì¢€ë¹„ë¥¼ ë§ˆì£¼ì³¤ìŠµë‹ˆë‹¤.`, hp: -10, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) ë°±í™”ì  íí—ˆì—ì„œ í™”ë ¤í•œ ì˜·ì„ ë°œê²¬í•˜ê³  ìž…ì–´ë³´ë©° ì¦ê±°ì›Œí–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ëª¨ë‘ì˜ ì£¼ëª©ì„ ë°›ìœ¼ë©° ìš©ê°í•˜ê²Œ ì†Œë¦¬ë¥¼ ì§ˆëŸ¬ ì¢€ë¹„ë¥¼ ìœ ì¸í–ˆìŠµë‹ˆë‹¤.`, hp: -5, kill: 1 },
                  { text: `${name}ì€(ëŠ”) í˜„ìž¬ì˜ ìˆœê°„ì— ì§‘ì¤‘í•˜ë©° ìœ í†µê¸°í•œì´ ë‚¨ì€ ë§›ìžˆëŠ” í†µì¡°ë¦¼ì„ ë°œê²¬í•´ í™˜í˜¸í–ˆìŠµë‹ˆë‹¤.` },
                  { text: `${name}ì€(ëŠ”) ë¬´ì„œìš´ ì´ì•¼ê¸°ë¥¼ ì‹¤ê° ë‚˜ê²Œ í•´ì„œ ëª¨ë‘ë¥¼ ê³µí¬ì— ë–¨ê²Œ í–ˆìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ìš°ì—°ížˆ ë°œê²¬í•œ í™”ìž¥í’ˆìœ¼ë¡œ ì¹˜ìž¥í•˜ë©° ì¦ê±°ì›Œí–ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ì‹¬ê°í•œ íšŒì˜ ì‹œê°„ì— ë”´ì²­ì„ í”¼ìš°ë‹¤ ì§€ì ë°›ì•˜ìŠµë‹ˆë‹¤.`, sanity: -2 },
                  { text: `${name}ì€(ëŠ”) ì¢€ë¹„ í‰ë‚´ë¥¼ ë‚´ë©° ìž¥ë‚œì¹˜ë‹¤ê°€ ì§„ì§œ ì¢€ë¹„ì—ê²Œ ë“¤í‚¬ ë»”í–ˆìŠµë‹ˆë‹¤.`, hp: -2, sanity: -5 },
                  { text: `${name}ì€(ëŠ”) íŒŒí‹°ë¥¼ ì—´ìžê³  ì œì•ˆí•˜ë©° ìˆ¨ê²¨ë‘” ê³¼ìžë¥¼ êº¼ëƒˆìŠµë‹ˆë‹¤.`, sanity: 10 },
                  { text: `${name}ì€(ëŠ”) ê·¸ë¦¼ìž ë†€ì´ë¡œ ì•„ì´ë“¤ì„ ì¦ê²ê²Œ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.`, sanity: 5 },
                  { text: `${name}ì€(ëŠ”) ê±°ìš¸ì´ ì—†ë‹¤ë©° ë¶ˆí‰í–ˆì§€ë§Œ ê¸ˆì„¸ ì›ƒì–´ë„˜ê²¼ìŠµë‹ˆë‹¤.`, sanity: 2 },
                  { text: `${name}ì€(ëŠ”) ë¶„ìœ„ê¸° ë©”ì´ì»¤ ì—­í• ì„ í†¡í†¡ížˆ í•´ëƒˆìŠµë‹ˆë‹¤.` }
              ];
              return actions[Math.floor(Math.random() * actions.length)];
          }
      };

      const simulateDay = async (day, characters) => {
        const livingCharacters = characters.filter(c => c.status !== 'Dead' && c.status !== 'Missing');
        
        if (livingCharacters.length === 0) {
          return {
            narrative: "ì¹¨ë¬µì´ ìº í”„ì— ë‚´ë ¤ì•‰ì•˜ìŠµë‹ˆë‹¤. ìƒì¡´ìžê°€ ë” ì´ìƒ ì—†ìŠµë‹ˆë‹¤.",
            events: ["ê²Œìž„ ì˜¤ë²„."],
            updates: []
          };
        }

        const narrative = GLOBAL_EVENTS[Math.floor(Math.random() * GLOBAL_EVENTS.length)];
        const events = [];
        const updates = [];

        const getUpdate = (id) => {
          let u = updates.find(up => up.id === id);
          if (!u) {
              u = { id };
              updates.push(u);
          }
          return u;
        };

        const shuffledChars = [...livingCharacters].sort(() => Math.random() - 0.5);

        shuffledChars.forEach(char => {
            if (Math.random() > 0.8) return;

            const action = MBTI_SPECIFIC_ACTIONS[char.mbti](char.name, char.gender);
            
            const update = getUpdate(char.id);
            update.hpChange = (update.hpChange || 0) + (action.hp || 0);
            update.sanityChange = (update.sanityChange || 0) + (action.sanity || 0);
            update.killCountChange = (update.killCountChange || 0) + (action.kill || 0);

            const currentHp = char.hp + (update.hpChange || 0);
            if (currentHp <= 0) {
                update.status = 'Dead';
                update.hpChange = -char.hp;
                events.push(`ðŸ’€ ${action.text} ê·¸ë¦¬ê³ ... ${char.name}ì€(ëŠ”) ìˆ¨ì„ ê±°ë‘ì—ˆìŠµë‹ˆë‹¤.`);
            } else {
                events.push(action.text);
            }
        });

        if (livingCharacters.length > 1) {
            const actorIndex = Math.floor(Math.random() * livingCharacters.length);
            let targetIndex = Math.floor(Math.random() * livingCharacters.length);
            while (actorIndex === targetIndex) {
                targetIndex = Math.floor(Math.random() * livingCharacters.length);
            }

            const actor = livingCharacters[actorIndex];
            const target = livingCharacters[targetIndex];
            
            const isLover = actor.relationshipStatuses[target.id] === 'Lover';
            const isEx = actor.relationshipStatuses[target.id] === 'Ex';
            const affinity = actor.relationships[target.id] || 0;

            let triggeredEvent = '';
            let affinityChange = 0;
            let newStatus = undefined;

            if (isLover && (affinity < 40 || Math.random() < 0.1)) {
                triggeredEvent = BREAKUP_EVENTS[Math.floor(Math.random() * BREAKUP_EVENTS.length)](actor.name, target.name);
                affinityChange = -30;
                newStatus = 'Ex';
                events.push(`ðŸ’” ${triggeredEvent}`);
            }
            else if (isLover) {
                triggeredEvent = LOVER_EVENTS[Math.floor(Math.random() * LOVER_EVENTS.length)](actor.name, target.name);
                affinityChange = 5;
                events.push(`ðŸ’• ${triggeredEvent}`);
            }
            else if (!isLover && !isEx && affinity >= 70 && Math.random() < 0.4) {
                if (Math.random() > 0.5) {
                    triggeredEvent = CONFESSION_EVENTS[Math.floor(Math.random() * CONFESSION_EVENTS.length)](actor.name, target.name);
                    affinityChange = 10;
                    newStatus = 'Lover';
                    events.push(`ðŸ’˜ ${triggeredEvent}`);
                } else {
                    events.push(`ðŸ’¬ ${actor.name}ì€(ëŠ”) ${target.name}ì—ê²Œ ê³ ë°±í•˜ë ¤ í–ˆì§€ë§Œ, íƒ€ì´ë°ì„ ë†“ì³ ì–´ìƒ‰í•´ì¡ŒìŠµë‹ˆë‹¤.`);
                    affinityChange = -5;
                }
            }
            else {
                const getGroup = (m) => {
                    if (ANALYSTS.includes(m)) return 'ANALYST';
                    if (DIPLOMATS.includes(m)) return 'DIPLOMAT';
                    if (SENTINELS.includes(m)) return 'SENTINEL';
                    return 'EXPLORER';
                };
                const isCompatible = getGroup(actor.mbti) === getGroup(target.mbti);
                affinityChange = isCompatible ? 15 : (Math.random() > 0.5 ? 10 : -10);

                let interactionText = "";
                if (affinityChange > 0) {
                    const templates = INTERACTION_TEMPLATES.POSITIVE;
                    interactionText = templates[Math.floor(Math.random() * templates.length)](actor.name, target.name);
                } else {
                    const templates = INTERACTION_TEMPLATES.NEGATIVE;
                    interactionText = templates[Math.floor(Math.random() * templates.length)](actor.name, target.name);
                }
                events.push(`ðŸ¤ ${interactionText}`);
            }

            const actorUpdate = getUpdate(actor.id);
            if (!actorUpdate.relationshipUpdates) actorUpdate.relationshipUpdates = [];
            actorUpdate.relationshipUpdates.push({ targetId: target.id, change: affinityChange, newStatus });

            const targetUpdate = getUpdate(target.id);
            if (!targetUpdate.relationshipUpdates) targetUpdate.relationshipUpdates = [];
            targetUpdate.relationshipUpdates.push({ targetId: actor.id, change: affinityChange, newStatus });
        }

        await new Promise(resolve => setTimeout(resolve, 800));

        return { narrative, events, updates };
      };

      // --- COMPONENTS ---

      const CharacterForm = ({ onAdd, disabled }) => {
        const [name, setName] = useState('');
        const [gender, setGender] = useState('Male');
        const [mbti, setMbti] = useState('ISTJ');

        const handleSubmit = (e) => {
          e.preventDefault();
          if (name.trim()) {
            onAdd(name, gender, mbti);
            setName('');
          }
        };

        return (
          <form onSubmit={handleSubmit} className="bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-200 dark:border-slate-700 shadow-md">
            <h3 className="text-lg font-bold mb-4 text-zombie-green">New Survivor</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm text-slate-600 dark:text-slate-400 mb-1">Name</label>
                <input
                  type="text"
                  value={name}
                  onChange={(e) => setName(e.target.value)}
                  className="w-full bg-gray-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded p-2 text-slate-900 dark:text-slate-100 focus:border-zombie-green dark:focus:border-zombie-green focus:outline-none"
                  placeholder="Survivor Name"
                  maxLength={20}
                  required
                  disabled={disabled}
                />
              </div>
              
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm text-slate-600 dark:text-slate-400 mb-1">Gender</label>
                  <select
                    value={gender}
                    onChange={(e) => setGender(e.target.value)}
                    className="w-full bg-gray-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded p-2 text-slate-900 dark:text-slate-100 focus:border-zombie-green dark:focus:border-zombie-green focus:outline-none"
                    disabled={disabled}
                  >
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-Binary">Non-Binary</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm text-slate-600 dark:text-slate-400 mb-1">MBTI</label>
                  <select
                    value={mbti}
                    onChange={(e) => setMbti(e.target.value)}
                    className="w-full bg-gray-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded p-2 text-slate-900 dark:text-slate-100 focus:border-zombie-green dark:focus:border-zombie-green focus:outline-none"
                    disabled={disabled}
                  >
                    {MBTI_TYPES.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                </div>
              </div>

              <button
                type="submit"
                disabled={!name.trim() || disabled}
                className="w-full bg-zombie-green hover:bg-lime-600 text-white dark:text-slate-900 font-bold py-2 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-sm"
              >
                Add to Group
              </button>
            </div>
          </form>
        );
      };

      const CharacterCard = ({ character, allCharacters, onDelete }) => {
        const isDead = character.status === 'Dead' || character.status === 'Missing';
        const isInfected = character.status === 'Infected';
        
        const getStatusColor = () => {
          if (character.status === 'Dead') return 'text-gray-500 bg-gray-100 border-gray-300 dark:text-gray-600 dark:bg-gray-900 dark:border-gray-700 opacity-60';
          if (character.status === 'Infected') return 'text-zombie-green border-zombie-green bg-green-50 dark:bg-green-900/20';
          if (character.status === 'Missing') return 'text-yellow-600 dark:text-yellow-500 border-yellow-500 bg-yellow-50 dark:bg-yellow-900/10';
          return 'text-slate-800 dark:text-slate-200 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800';
        };

        const getRelationshipName = (id) => {
          const target = allCharacters.find(c => c.id === id);
          return target ? target.name : 'Unknown';
        };

        const loverId = Object.keys(character.relationshipStatuses).find(key => character.relationshipStatuses[key] === 'Lover');
        const loverName = loverId ? getRelationshipName(loverId) : null;

        const topRelationships = Object.entries(character.relationships)
          .sort(([, a], [, b]) => Math.abs(b) - Math.abs(a))
          .slice(0, 3);

        return (
          <div className={`border p-4 rounded-lg shadow-sm hover:shadow-md transition-all ${getStatusColor()} relative overflow-hidden group`}>
            {isDead && (
              <div className="absolute inset-0 flex items-center justify-center z-10 bg-white/70 dark:bg-black/60 font-bold text-3xl uppercase tracking-widest text-red-600 rotate-12 border-4 border-red-600 rounded-lg pointer-events-none">
                {character.status}
              </div>
            )}
            
            <div className="flex justify-between items-start mb-2">
              <div>
                <h3 className="font-bold text-xl flex items-center gap-2">
                    {character.name}
                    {loverName && <span title={`Lover: ${loverName}`} className="text-sm cursor-help">â¤ï¸</span>}
                </h3>
                <div className="flex items-center gap-2 text-xs uppercase tracking-wide opacity-80">
                  <span className="bg-slate-200 dark:bg-slate-700 px-1 rounded text-slate-700 dark:text-slate-300">{character.mbti}</span>
                  <span className="text-slate-600 dark:text-slate-400">{character.gender}</span>
                </div>
              </div>
              <div className="text-right text-xs flex flex-col items-end gap-1 relative z-20">
                  <button 
                      onClick={(e) => {
                          e.stopPropagation();
                          onDelete(character.id);
                      }}
                      className="text-slate-400 hover:text-red-500 p-1.5 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors"
                      title="Delete Survivor"
                  >
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-4 h-4">
                          <path fillRule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clipRule="evenodd" />
                      </svg>
                  </button>
                  <div className="font-mono text-slate-600 dark:text-slate-400">Kills: {character.killCount}</div>
                  <div className={`font-bold ${isInfected ? 'text-green-600 dark:text-green-400 animate-pulse' : ''}`}>{character.status}</div>
              </div>
            </div>

            <div className="space-y-2 mt-4 text-xs font-mono text-slate-600 dark:text-slate-400">
              <div className="w-full">
                <div className="flex justify-between mb-0.5">
                  <span>HP</span>
                  <span>{character.hp}/{MAX_HP}</span>
                </div>
                <div className="h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-red-500 dark:bg-red-600 transition-all duration-500" 
                    style={{ width: `${(character.hp / MAX_HP) * 100}%` }}
                  ></div>
                </div>
              </div>

              <div className="w-full">
                <div className="flex justify-between mb-0.5">
                  <span>SANITY</span>
                  <span>{character.sanity}/{MAX_SANITY}</span>
                </div>
                <div className="h-2 w-full bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                  <div 
                    className="h-full bg-blue-500 transition-all duration-500" 
                    style={{ width: `${(character.sanity / MAX_SANITY) * 100}%` }}
                  ></div>
                </div>
              </div>
            </div>

            <div className="mt-4 pt-3 border-t border-slate-200 dark:border-white/10">
              <h4 className="text-xs uppercase text-slate-500 dark:text-slate-400 mb-1">Key Relationships</h4>
              {topRelationships.length > 0 ? (
                <ul className="space-y-1 text-xs">
                  {topRelationships.map(([id, score]) => {
                    const status = character.relationshipStatuses[id];
                    return (
                      <li key={id} className="flex justify-between items-center">
                        <span className="text-slate-700 dark:text-slate-300 flex items-center gap-1">
                            {getRelationshipName(id)}
                            {status === 'Lover' && 'â¤ï¸'}
                            {status === 'Ex' && 'ðŸ’”'}
                        </span>
                        <span className={score > 0 ? 'text-green-600 dark:text-green-400' : score < 0 ? 'text-red-600 dark:text-red-400' : 'text-gray-400'}>
                          {score > 0 ? '+' : ''}{score}
                        </span>
                      </li>
                    );
                  })}
                </ul>
              ) : (
                  <p className="text-xs text-slate-400 dark:text-slate-500 italic">No significant bonds yet.</p>
              )}
            </div>
          </div>
        );
      };

      const EventLog = ({ logs }) => {
        const endRef = useRef(null);

        useEffect(() => {
          endRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [logs]);

        return (
          <div className="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg h-[500px] overflow-y-auto flex flex-col font-mono text-sm relative shadow-sm">
            <div className="sticky top-0 bg-gray-100 dark:bg-slate-800 p-2 border-b border-slate-200 dark:border-slate-700 font-bold z-10 flex items-center gap-2 text-slate-700 dark:text-slate-200">
              <span className="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
              Mission Log
            </div>
            <div className="p-4 space-y-6 flex-1">
              {logs.length === 0 && (
                <div className="text-slate-400 dark:text-slate-500 text-center mt-10 italic">
                  Waiting for simulation to start...
                </div>
              )}
              {logs.map((log) => (
                <div key={log.day} className="animate-fade-in border-l-2 border-slate-200 dark:border-slate-700 pl-4 pb-4">
                  <h4 className="text-zombie-green font-bold mb-2">Day {log.day}</h4>
                  <p className="mb-3 text-slate-700 dark:text-slate-300 leading-relaxed italic">{log.narrative}</p>
                  <ul className="space-y-1">
                    {log.events.map((event, idx) => (
                      <li key={idx} className="flex gap-2 items-start text-slate-500 dark:text-slate-400">
                        <span className="text-slate-400 dark:text-slate-600 mt-1">âž¤</span>
                        <span>{event}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
              <div ref={endRef} />
            </div>
          </div>
        );
      };

      const RelationshipMap = ({ characters, onClose }) => {
        const nodes = useMemo(() => 
          characters.filter(c => c.status !== 'Dead' && c.status !== 'Missing'), 
        [characters]);

        const width = 800;
        const height = 600;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = Math.min(width, height) / 2 - 100;

        const nodePositions = useMemo(() => {
          return nodes.map((node, index) => {
            const angle = (index / nodes.length) * 2 * Math.PI - Math.PI / 2;
            return {
              ...node,
              x: centerX + radius * Math.cos(angle),
              y: centerY + radius * Math.sin(angle),
            };
          });
        }, [nodes, radius, centerX, centerY]);

        const links = useMemo(() => {
          const linkList = [];
          
          for (let i = 0; i < nodePositions.length; i++) {
            for (let j = i + 1; j < nodePositions.length; j++) {
              const source = nodePositions[i];
              const target = nodePositions[j];
              const aToB = source.relationships[target.id] || 0;
              const bToA = target.relationships[source.id] || 0;
              const status = source.relationshipStatuses[target.id] || 'None';
              const avgAffinity = (aToB + bToA) / 2;
              
              linkList.push({ source, target, affinity: avgAffinity, status });
            }
          }
          return linkList;
        }, [nodePositions]);

        const getLineStyle = (affinity, status) => {
          if (status === 'Lover') return { stroke: '#ec4899', width: 6, label: 'ì—°ì¸', opacity: 1 };
          if (status === 'Ex') return { stroke: '#9f1239', width: 2, label: 'ì „ ì• ì¸', opacity: 0.8, dash: '5,5' };
          if (affinity >= 60) return { stroke: '#3b82f6', width: 4, label: 'ì ˆì¹œ', opacity: 0.9 };
          if (affinity >= 10) return { stroke: '#22c55e', width: 3, label: 'ì¹œêµ¬', opacity: 0.7 };
          if (affinity <= -40) return { stroke: '#ef4444', width: 5, label: 'í˜ì˜¤', opacity: 0.9 };
          if (affinity <= -10) return { stroke: '#f97316', width: 3, label: 'ì‹«ì–´í•¨', opacity: 0.7 };
          return { stroke: '#94a3b8', width: 1, label: 'ë‚¨', opacity: 0.2 };
        };

        if (nodes.length < 2) {
            return (
              <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
                  <div className="bg-white dark:bg-slate-800 p-8 rounded-lg max-w-md text-center shadow-2xl border border-slate-700">
                      <h2 className="text-2xl font-bold mb-4 text-white">ì¸ë¬¼ ê´€ê³„ë„</h2>
                      <p className="text-slate-300 mb-6">ê´€ê³„ë„ë¥¼ í‘œì‹œí•  ìƒì¡´ìžê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ìµœì†Œ 2ëª…).</p>
                      <button onClick={onClose} className="bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-full transition-colors">ë‹«ê¸°</button>
                  </div>
              </div>
            );
        }

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md p-4 animate-fade-in">
            <div className="relative w-full max-w-5xl bg-slate-900 rounded-xl overflow-hidden shadow-2xl border border-slate-700 flex flex-col max-h-[90vh]">
              <div className="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800">
                  <h2 className="text-xl font-bold text-white flex items-center gap-2"><span>ðŸ•¸ï¸</span> ì¸ë¬¼ ê´€ê³„ë„ (Relationship Map)</h2>
                  <button onClick={onClose} className="text-slate-400 hover:text-white transition-colors p-2">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                  </button>
              </div>
              <div className="flex-1 overflow-auto relative bg-slate-950 flex justify-center items-center p-4">
                  <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full max-w-[800px] select-none">
                      {links.map((link, i) => {
                          const style = getLineStyle(link.affinity, link.status);
                          return (
                              <g key={i}>
                                  <line
                                      x1={link.source.x} y1={link.source.y}
                                      x2={link.target.x} y2={link.target.y}
                                      stroke={style.stroke} strokeWidth={style.width} strokeOpacity={style.opacity}
                                      strokeLinecap={style.dash ? 'square' : 'round'} strokeDasharray={style.dash}
                                  />
                              </g>
                          );
                      })}
                      {nodePositions.map((node) => (
                          <g key={node.id} transform={`translate(${node.x}, ${node.y})`} className="cursor-pointer hover:scale-110 transition-transform duration-200">
                              <circle r="30" fill="#1e293b" stroke="#cbd5e1" strokeWidth="2" />
                              <text textAnchor="middle" dy=".3em" fill="white" fontSize="12" fontWeight="bold" className="pointer-events-none">{node.name.slice(0, 3)}</text>
                              <text textAnchor="middle" dy="2.5em" fill="#94a3b8" fontSize="10" className="pointer-events-none">{node.mbti}</text>
                          </g>
                      ))}
                  </svg>
                  <div className="absolute bottom-4 left-4 bg-slate-800/80 p-4 rounded-lg border border-slate-700 text-xs backdrop-blur-sm">
                      <h4 className="font-bold text-slate-300 mb-2">ê´€ê³„ ë²”ë¡€ (Affinity)</h4>
                      <div className="space-y-1.5">
                          <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-pink-500 ring-2 ring-pink-900"></span><span className="text-pink-200 font-bold">ì—°ì¸ (ê³ ë°± ì„±ê³µ)</span></div>
                          <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-blue-500"></span><span className="text-blue-200">ì ˆì¹œ (60+)</span></div>
                          <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-green-500"></span><span className="text-green-200">ì¹œêµ¬ (10~59)</span></div>
                          <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-slate-400"></span><span className="text-slate-300">ë‚¨ (-9~9)</span></div>
                          <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-rose-900 border border-rose-500"></span><span className="text-rose-200">ì „ ì• ì¸ (ì´ë³„)</span></div>
                          <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-red-500"></span><span className="text-red-200">í˜ì˜¤ (-40 ì´í•˜)</span></div>
                      </div>
                  </div>
              </div>
            </div>
          </div>
        );
      };

      const App = () => {
        const [day, setDay] = useState(0);
        const [characters, setCharacters] = useState([]);
        const [logs, setLogs] = useState([]);
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState(null);
        const [darkMode, setDarkMode] = useState(false);
        const [showRelationshipMap, setShowRelationshipMap] = useState(false);

        useEffect(() => {
          if (darkMode) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        }, [darkMode]);

        const generateId = () => crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).substring(2, 15);

        const addCharacter = (name, gender, mbti) => {
          const newChar = {
            id: generateId(),
            name,
            gender,
            mbti,
            hp: MAX_HP,
            sanity: MAX_SANITY,
            status: 'Alive',
            inventory: [...INITIAL_INVENTORY],
            relationships: {},
            relationshipStatuses: {},
            killCount: 0
          };

          setCharacters(prev => {
            const updatedPrev = prev.map(c => ({
              ...c,
              relationships: {
                ...c.relationships,
                [newChar.id]: DEFAULT_RELATIONSHIP_VALUE
              },
              relationshipStatuses: {
                 ...c.relationshipStatuses,
                 [newChar.id]: 'None'
              }
            }));
            
            prev.forEach(c => {
              newChar.relationships[c.id] = DEFAULT_RELATIONSHIP_VALUE;
              newChar.relationshipStatuses[c.id] = 'None';
            });

            return [...updatedPrev, newChar];
          });
        };

        const deleteCharacter = (id) => {
          setCharacters(prev => {
            const remaining = prev.filter(c => c.id !== id);
            return remaining.map(c => {
              const newRels = { ...c.relationships };
              const newStatuses = { ...c.relationshipStatuses };
              if (id in newRels) delete newRels[id];
              if (id in newStatuses) delete newStatuses[id];
              return { ...c, relationships: newRels, relationshipStatuses: newStatuses };
            });
          });
        };

        const handleNextDay = useCallback(async () => {
          if (loading) return;
          if (characters.filter(c => c.status === 'Alive').length === 0) {
              setError("No survivors left to continue simulation.");
              return;
          }

          setLoading(true);
          setError(null);
          
          try {
            const nextDay = day + 1;
            const result = await simulateDay(nextDay, characters);

            setCharacters(prev => {
              const nextChars = [...prev];
              
              result.updates.forEach((update) => {
                const index = nextChars.findIndex(c => c.id === update.id);
                if (index === -1) return;

                const char = { ...nextChars[index] };
                
                if (update.hpChange) char.hp = Math.max(0, Math.min(MAX_HP, char.hp + update.hpChange));
                if (update.sanityChange) char.sanity = Math.max(0, Math.min(MAX_SANITY, char.sanity + update.sanityChange));
                if (update.status) char.status = update.status;
                if (update.killCountChange) char.killCount += update.killCountChange;

                if (update.inventoryAdd) char.inventory = [...char.inventory, ...update.inventoryAdd];
                if (update.inventoryRemove) {
                   char.inventory = char.inventory.filter(item => !update.inventoryRemove?.includes(item));
                }

                if (update.relationshipUpdates) {
                   const newRels = { ...char.relationships };
                   const newStatuses = { ...char.relationshipStatuses };
                   
                   update.relationshipUpdates.forEach((rel) => {
                       const currentVal = newRels[rel.targetId] || 0;
                       newRels[rel.targetId] = Math.max(-100, Math.min(100, currentVal + rel.change));
                       
                       if (rel.newStatus) {
                           newStatuses[rel.targetId] = rel.newStatus;
                       }
                   });
                   char.relationships = newRels;
                   char.relationshipStatuses = newStatuses;
                }

                nextChars[index] = char;
              });

              return nextChars;
            });

            setLogs(prev => [...prev, {
              day: nextDay,
              narrative: result.narrative,
              events: result.events
            }]);

            setDay(nextDay);

          } catch (err) {
            console.error(err);
            setError("Simulation Failed. Please try again.");
          } finally {
            setLoading(false);
          }
        }, [day, characters, loading]);

        const activeSurvivors = characters.filter(c => c.status !== 'Dead' && c.status !== 'Missing').length;

        return (
          <div className="min-h-screen p-4 md:p-8 max-w-7xl mx-auto transition-colors duration-300">
            <header className="mb-8 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-slate-300 dark:border-slate-700 pb-6">
              <div className="flex items-center gap-4">
                <div>
                  <h1 className="text-4xl font-bold tracking-tighter text-slate-800 dark:text-slate-100">
                    <span className="text-red-600">Z</span>-SIMULATOR
                  </h1>
                  <p className="text-slate-500 dark:text-slate-400 text-sm mt-1">Personality-Driven Apocalypse Engine</p>
                </div>
                <button 
                  onClick={() => setDarkMode(!darkMode)}
                  className="p-2 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors"
                  title="Toggle Dark Mode"
                >
                  {darkMode ? (
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" /></svg>
                  ) : (
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" /></svg>
                  )}
                </button>
              </div>
              
              <div className="flex flex-wrap justify-end items-center gap-4">
                  <button
                      onClick={() => setShowRelationshipMap(true)}
                      disabled={activeSurvivors < 2}
                      className={`flex items-center gap-2 px-4 py-2 rounded font-bold text-sm transition-all border
                          ${activeSurvivors < 2 
                              ? 'border-slate-300 text-slate-400 cursor-not-allowed dark:border-slate-700 dark:text-slate-600'
                              : 'border-blue-500 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20'
                          }
                      `}
                  >
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z" /></svg>
                      ê´€ê³„ë„ (Map)
                  </button>

                <div className="text-right pl-4 border-l border-slate-300 dark:border-slate-700 hidden sm:block">
                  <div className="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-widest">Day</div>
                  <div className="text-3xl font-mono font-bold text-zombie-green">{day}</div>
                </div>
                <div className="text-right pl-4 border-l border-slate-300 dark:border-slate-700 hidden sm:block">
                   <div className="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-widest">Survivors</div>
                   <div className="text-3xl font-mono font-bold text-slate-800 dark:text-white">{activeSurvivors}/{characters.length}</div>
                </div>
                <button
                  onClick={handleNextDay}
                  disabled={loading || characters.length === 0}
                  className={`
                    ml-2 px-6 py-3 rounded font-bold text-lg uppercase tracking-wide transition-all shadow-md flex items-center gap-2
                    ${loading 
                      ? 'bg-slate-300 dark:bg-slate-700 text-slate-500 dark:text-slate-400 cursor-wait' 
                      : characters.length === 0 
                        ? 'bg-slate-300 dark:bg-slate-800 text-slate-500 dark:text-slate-600 cursor-not-allowed'
                        : 'bg-red-600 hover:bg-red-700 text-white shadow-red-900/20'
                    }
                  `}
                >
                  {loading ? 'Thinking...' : (
                      <>
                      Next Day
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" /></svg>
                      </>
                  )}
                </button>
              </div>
            </header>

            {error && (
              <div className="mb-6 p-4 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-800 text-red-800 dark:text-red-200 rounded">
                {error}
              </div>
            )}

            {showRelationshipMap && (
                <RelationshipMap characters={characters} onClose={() => setShowRelationshipMap(false)} />
            )}

            <main className="grid grid-cols-1 lg:grid-cols-12 gap-8">
              <div className="lg:col-span-4 order-2 lg:order-1">
                <EventLog logs={logs} />
              </div>

              <div className="lg:col-span-8 order-1 lg:order-2 space-y-8">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                   <CharacterForm onAdd={addCharacter} disabled={loading} />
                   
                   <div className="bg-white dark:bg-slate-800/50 p-6 rounded-lg border border-slate-200 dark:border-slate-700 flex flex-col justify-center items-center text-center shadow-sm">
                      <h3 className="text-lg font-bold text-slate-700 dark:text-slate-300 mb-2">Simulation Status</h3>
                      {characters.length === 0 ? (
                        <p className="text-slate-500">Add survivors to begin the simulation.</p>
                      ) : (
                        <div className="space-y-1">
                            <p className="text-slate-600 dark:text-slate-400 text-sm">
                              {activeSurvivors > 0 
                                ? "The group is currently surviving. Interactions are generated based on MBTI traits." 
                                : "All survivors have perished."}
                            </p>
                            {day > 0 && (
                                <p className="text-xs text-slate-400 italic">
                                   Check the "Relationship Map" to see how they feel about each other.
                                </p>
                            )}
                        </div>
                      )}
                   </div>
                </div>

                <div>
                  <h2 className="text-2xl font-bold mb-4 text-slate-800 dark:text-slate-200 flex items-center gap-2">
                    Survivors <span className="text-xs bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 px-2 py-0.5 rounded-full">{characters.length}</span>
                  </h2>
                  <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                    {characters.map(char => (
                      <CharacterCard 
                        key={char.id} 
                        character={char} 
                        allCharacters={characters}
                        onDelete={deleteCharacter}
                      />
                    ))}
                  </div>
                </div>
              </div>
            </main>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>